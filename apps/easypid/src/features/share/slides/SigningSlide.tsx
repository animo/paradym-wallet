import { Trans, useLingui } from '@lingui/react/macro'
import type { QtspInfo } from '@package/agent'
import { DualResponseButtons, useImageScaler, useWizard } from '@package/app'
import { commonMessages } from '@package/translations'
import { Heading, Paragraph, YStack } from '@package/ui'
import { useEffect } from 'react'
import { Defs, LinearGradient, Path, Stop, Svg } from 'react-native-svg'

interface SigningSlideProps {
  documentNames: string[]
  qtsp: QtspInfo
  possibleCredentialIds: string[]
  selectedCredentialId?: string
  onCredentialSelect?: (credentialId: string) => void
}

export function SigningSlide({
  documentNames,
  possibleCredentialIds,
  selectedCredentialId,
  onCredentialSelect,
}: SigningSlideProps) {
  const { onNext, onCancel } = useWizard()
  const { height, onLayout } = useImageScaler({ scaleFactor: 0.65 })
  const { t } = useLingui()

  useEffect(() => {
    if (possibleCredentialIds.length > 0 && selectedCredentialId !== possibleCredentialIds[0]) {
      onCredentialSelect?.(possibleCredentialIds[0])
    }
  }, [possibleCredentialIds, onCredentialSelect, selectedCredentialId])

  const documentName = documentNames.join(', ')

  return (
    <YStack fg={1} jc="space-between">
      <YStack gap="$4">
        <Heading>
          <Trans id="signing.title" comment="Heading above the document signing screen">
            Signing a document
          </Trans>
        </Heading>
        <Paragraph>
          <Trans id="signing.description" comment="Explanation that the user is about to sign a document">
            You are about to sign <Paragraph emphasis>{documentName}</Paragraph>.
          </Trans>
        </Paragraph>
      </YStack>

      <YStack fg={1} jc="center" ai="center" onLayout={onLayout}>
        <YStack height={height}>
          <SigningSvg />
        </YStack>
        <YStack h="$4" />
      </YStack>

      <YStack btw="$0.5" borderColor="$grey-200" py="$4" mx="$-4" px="$4" bg="$background">
        <DualResponseButtons
          align="horizontal"
          acceptText={t(commonMessages.continue)}
          declineText={t(commonMessages.stop)}
          onAccept={() => onNext()}
          onDecline={() => onCancel()}
          isLoading={false}
        />
      </YStack>
    </YStack>
  )
}

export function SigningSvg() {
  return (
    <Svg width="100%" height="100%" style={{ aspectRatio: 1 }} viewBox="0 0 300 307" fill="none">
      <Path
        d="M204.573 160.25C219.637 172.743 242.828 191.902 246.443 211.417C254.276 253.693 202.655 294.382 166.123 304.318C98.5168 322.702 39.3834 242.49 12.5649 190.217C-8.31444 149.503 -7.15851 110.338 46.9088 102.099C99.8818 94.0325 164.598 127.111 204.561 160.25H204.573Z"
        fill="url(#paint0_linear_2616_8734)"
      />
      <Path
        d="M145.784 101.421C134.987 94.0922 118.35 82.8653 114.698 70.126C106.792 42.5568 138.455 12.2332 162.076 3.2935C205.79 -13.2455 250.192 36.2117 271.355 69.216C287.832 94.9161 289.565 120.997 254.201 129.925C219.537 138.68 174.447 120.862 145.796 101.421H145.784Z"
        fill="url(#paint1_linear_2616_8734)"
      />
      <Path
        d="M206.822 20.1122C189.398 13.7794 171.163 16.829 154.538 24.207C148.783 26.5434 143.09 29.4331 136.77 31.9908C136.487 32.1138 136.192 31.6957 136.462 31.4866C141.283 27.1705 146.447 23.1987 152.079 19.9523C163.219 13.349 176.524 9.42639 189.497 11.8365C195.916 12.9801 202.15 15.5009 207.228 19.6572C207.499 19.9401 207.204 20.3212 206.822 20.1245V20.1122Z"
        fill="white"
      />
      <Path
        d="M186.99 278.383C194.429 269.738 202.016 262.397 209.419 254.171C215.739 247.26 221.641 239.894 227.125 232.27C227.974 231.078 228.872 229.848 229.892 228.655C230.077 228.421 230.495 228.63 230.396 228.926C226.031 245.465 214.891 259.458 201.5 269.775C197.036 273.243 192.314 276.378 187.261 278.948C186.99 279.084 186.683 278.727 186.904 278.494L186.99 278.395V278.383Z"
        fill="white"
      />
      <Path
        d="M106.599 73.7994L93.2634 249.925C92.8276 255.681 97.1404 260.7 102.896 261.136L173.252 266.464C179.008 266.899 184.027 262.586 184.463 256.83L197.799 80.7049C198.234 74.9488 193.922 69.9293 188.166 69.4934L117.81 64.1662C112.054 63.7304 107.035 68.0433 106.599 73.7994Z"
        fill="white"
      />
      <Path
        d="M173.306 266.651C155.918 265.237 120.886 262.777 103.486 261.56C97.2522 261.548 92.0016 255.547 92.8623 249.337L96.4283 196.953C98.9122 164.158 102.872 105.921 105.282 73.6789C105.651 67.3215 111.651 62.1078 118.021 62.698L187.84 67.6413L188.381 67.6781C194.726 68.047 200.038 73.8388 199.767 80.2085C198.058 105.761 194.947 142.995 192.746 168.622C191.148 185.972 187.987 220.993 186.401 238.344L184.938 255.78C185.036 261.867 179.454 267.327 173.306 266.651ZM173.33 266.282C179.257 266.786 184.471 261.621 184.286 255.731L185.467 238.27L187.594 203.335C189.377 172.2 192.205 129.653 194.603 98.5674L195.968 81.1184C196.669 76.0522 192.697 71.3917 187.569 71.2934L117.8 65.6492C113.004 65.1696 108.405 69.0923 108.098 73.9126C105.54 105.909 100.867 164.564 98.2728 197.113L93.9075 249.435C93.0713 255.178 97.7194 260.687 103.56 260.798C120.96 262.212 155.943 265.052 173.342 266.294L173.33 266.282Z"
        fill="#2A337E"
      />
      <Path
        d="M168.021 77.4548L136.448 75.0642C135.582 74.9985 134.826 75.648 134.76 76.5148L134.729 76.9194C134.664 77.7862 135.313 78.5421 136.18 78.6077L167.753 80.9984C168.62 81.064 169.376 80.4146 169.441 79.5477L169.472 79.1431C169.537 78.2763 168.888 77.5204 168.021 77.4548Z"
        fill="#2A337E"
      />
      <Path
        d="M169.613 234.796L109.822 229.445C105.411 229.05 101.53 232.146 101.153 236.36C100.776 240.574 104.046 244.309 108.457 244.704L168.248 250.055C172.659 250.449 176.54 247.353 176.917 243.14C177.294 238.926 174.024 235.19 169.613 234.796Z"
        fill="#DFE7FA"
      />
      <Path
        d="M179.604 92.8471L122.804 88.9055C117.928 88.5672 113.617 89.8224 113.173 91.7091C112.73 93.5958 116.322 95.3994 121.197 95.7378L177.998 99.6793C182.873 100.018 187.186 98.7625 187.629 96.8758C188.073 94.9891 184.48 93.1854 179.604 92.8471Z"
        fill="#DFE7FA"
      />
      <Path
        d="M179.542 102.945L122.741 99.0032C117.866 98.6649 113.554 99.9201 113.111 101.807C112.667 103.693 116.259 105.497 121.135 105.835L177.935 109.777C182.811 110.115 187.123 108.86 187.567 106.973C188.01 105.087 184.417 103.283 179.542 102.945Z"
        fill="#DFE7FA"
      />
      <Path
        d="M165.708 178.776L166.122 170.57C166.263 167.772 165.311 165.033 163.474 162.957C161.638 160.881 159.068 159.637 156.329 159.499L151.74 159.267C150.827 159.221 149.971 158.807 149.359 158.115C148.746 157.423 148.429 156.51 148.476 155.577L148.712 150.888C148.853 148.09 147.901 145.352 146.064 143.275C144.228 141.199 141.658 139.955 138.919 139.817L133.183 139.528M131.173 179.384L154.118 180.541M130.7 188.762L142.172 189.341M140.067 139.875L125.153 139.123C123.253 139.027 121.631 140.525 121.534 142.466L118.814 196.389C118.716 198.33 120.179 199.984 122.078 200.08L161.084 202.047C162.984 202.143 164.605 200.645 164.703 198.704L166.181 169.398C166.558 161.936 164.018 154.634 159.12 149.097C154.223 143.561 147.369 140.243 140.067 139.875Z"
        stroke="#2A337E"
        strokeWidth="3"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <Path
        d="M167.612 179.718L168.252 171.519C168.471 168.723 167.57 165.955 165.747 163.823C163.925 161.692 161.33 160.372 158.534 160.153L153.849 159.787C152.917 159.714 152.052 159.274 151.445 158.564C150.837 157.853 150.537 156.93 150.609 155.998L150.976 151.313C151.194 148.517 150.293 145.749 148.47 143.617C146.648 141.486 144.053 140.166 141.257 139.947L135.401 139.489M142.429 140.039L127.201 138.849C125.262 138.697 123.564 140.149 123.413 142.088L119.203 195.97C119.051 197.91 120.502 199.607 122.442 199.759L162.267 202.871C164.207 203.022 165.904 201.571 166.056 199.631L168.344 170.348C168.926 162.892 166.523 155.51 161.663 149.826C156.803 144.142 149.884 140.621 142.429 140.039Z"
        stroke="#3858DB"
        strokeWidth="3"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <Path d="M131.465 179.637L156.037 180.925" stroke="#C6D4F7" strokeWidth="3" strokeLinecap="round" />
      <Path d="M130.992 189.039L143.845 189.713" stroke="#C6D4F7" strokeWidth="3" strokeLinecap="round" />
      <Path
        d="M36.5836 152.414C51.0215 152.414 62.7258 140.71 62.7258 126.272C62.7258 111.833 51.0215 100.129 36.5836 100.129C22.1457 100.129 10.4414 111.833 10.4414 126.272C10.4414 140.71 22.1457 152.414 36.5836 152.414Z"
        fill="#DFE7FA"
      />
      <Path
        d="M33.8535 147.117C48.2915 147.117 59.9957 135.412 59.9957 120.974C59.9957 106.536 48.2915 94.8314 33.8535 94.8314C19.4156 94.8314 7.71132 106.536 7.71132 120.974C7.71132 135.412 19.4156 147.117 33.8535 147.117Z"
        fill="white"
      />
      <Path
        d="M13.134 137.12C-1.20362 118.343 13.5029 91.6465 37.1612 94.2288C56.1715 96.2578 67.2384 117.851 57.6964 134.488C48.2035 151.347 24.6066 152.269 13.134 137.107V137.12ZM13.3308 136.972C27.3118 154.446 55.6797 145.899 58.5817 124.036C60.6475 110.669 50.4413 97.3645 36.9645 95.8151C14.4866 92.8762 -0.748615 118.957 13.3308 136.96V136.972Z"
        fill="#2A337E"
      />
      <Path
        d="M41.2868 109.272L43.6064 106.951C44.09 106.467 44.7458 106.195 45.4297 106.195C46.1135 106.195 46.7694 106.467 47.2529 106.951C47.7365 107.434 48.0082 108.09 48.0082 108.774C48.0082 109.458 47.7365 110.113 47.2529 110.597L27.4956 130.354C26.7686 131.081 25.8722 131.615 24.8872 131.908L21.1953 133.008L22.2953 129.316C22.5886 128.331 23.1226 127.435 23.8491 126.708L41.2882 109.272H41.2868ZM41.2868 109.272L44.9141 112.899"
        stroke="#7294E8"
        strokeWidth="2.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <Path
        d="M211.066 51.2852L226.893 67.8687L225.385 94.2614L240.467 82.1941L245.281 87.8492L257.807 102.55L299.269 64.8535L211.066 51.2852Z"
        fill="#DFE7FA"
      />
      <Path d="M226.574 88.944L243.889 86.0711L237.904 79.0508L226.574 88.944Z" fill="#2A337E" />
      <Path d="M224.332 64.56L222.863 90.3121L237.9 78.8853L296.708 62.043L224.332 64.56Z" fill="#2A337E" />
      <Path
        d="M208.5 48.1445L224.333 64.7281L222.825 91.1143L237.901 79.0535L242.721 84.7086L255.241 99.4093L296.709 61.7129L208.5 48.1445Z"
        fill="white"
      />
      <Path
        d="M208.593 48.1896L224.516 64.5597L224.587 64.6373V64.7473L223.241 91.14L222.568 90.7906L237.579 78.6392L237.974 78.3221L238.31 78.7104L255.748 98.982L254.81 98.9238L296.064 61.001L296.568 62.6703C268.138 58.5034 237.068 52.8483 208.599 48.1896H208.593ZM208.418 48.099C237.819 52.3177 269.626 56.3294 298.859 61.0786L297.358 62.4309L255.689 99.8944L255.185 100.347L254.751 99.8297L237.508 79.3898L238.239 79.4609L223.092 91.4376L222.361 92.0199L222.42 91.0947L224.095 64.715C224.542 65.5302 208.366 47.9179 208.424 48.099H208.418Z"
        fill="#2A337E"
      />
      <Path d="M238.126 79.0603L294.353 62.7227L224.358 64.735L222.824 91.1211L238.126 79.0603Z" fill="#7294E8" />
      <Path
        d="M238.084 78.9731L294.187 62.1631L294.369 63.3083C282.683 63.7224 253.16 64.7771 241.882 65.2041C237.528 65.3659 228.741 65.6182 224.387 65.7153L225.338 64.7965C224.775 73.3115 224.128 82.6289 223.455 91.1633L222.439 90.6327C227.628 86.7117 232.843 82.7971 238.084 78.9796V78.9731ZM238.175 79.1413C233.218 83.36 228.23 87.4881 223.215 91.6097C222.821 91.9591 222.135 91.6097 222.2 91.0792C222.323 87.7793 222.588 81.1666 222.756 77.8731C222.97 73.4733 223.138 69.0734 223.377 64.6736C223.403 64.1624 223.817 63.7677 224.315 63.7548C228.689 63.606 237.456 63.3472 241.824 63.2566C252.979 63.0366 282.813 62.3895 294.33 62.1372C294.653 62.1242 294.931 62.3831 294.938 62.7066C294.938 62.9783 294.763 63.2113 294.511 63.2824L238.168 79.1413H238.175Z"
        fill="#2A337E"
      />
      <Path
        d="M242.575 86.1094C239.702 86.7176 236.829 87.3129 233.95 87.8887C231.109 88.4517 228.042 89.1828 225.234 89.1569C228.055 88.2963 230.941 87.7916 233.859 87.3775C236.726 86.9893 239.799 86.3229 242.575 86.1094Z"
        fill="#2A337E"
      />
      <Path
        d="M163.883 189.95C160.121 194.602 153.133 193.263 153.133 193.263C151.958 210.768 162.334 213.037 162.334 213.037C162.334 213.037 172.92 212.171 174.095 194.67C174.095 194.67 166.987 195.062 163.883 189.95Z"
        fill="url(#paint2_linear_2616_8734)"
      />
      <Path
        d="M163.882 190.007C161.508 193.398 156.934 194.372 153.017 193.882L153.763 193.305L153.769 196.199C154.006 200.804 154.998 205.74 158.201 209.202C159.393 210.463 160.878 211.543 162.558 212.029L162.251 212.009C162.407 211.981 162.651 211.955 162.824 211.901C169.169 210.269 172.025 203.417 173.08 197.495L173.473 194.628L174.136 195.3C170.191 195.262 165.781 193.685 163.885 190.011L163.882 190.007ZM163.89 189.892C166.06 193.312 170.212 194.667 174.095 194.593C174.137 194.588 174.173 194.622 174.174 194.664C174.182 194.672 173.866 197.598 173.869 197.605C173.641 199.006 173.363 200.56 172.937 201.924C172.663 202.964 172.12 204.408 171.64 205.372C169.854 209.118 166.579 212.514 162.313 213.151C158.192 211.913 155.409 208.149 154.144 204.198C153.947 203.742 155.409 208.149 154.144 204.198C153.947 203.742 153.704 202.553 153.572 202.059C153.434 201.585 153.394 201.093 153.319 200.607C153.079 199.195 153.012 197.621 152.972 196.203L153.062 193.258C153.065 193.216 153.098 193.184 153.14 193.187C156.978 193.783 161.285 192.995 163.897 189.893L163.89 189.892Z"
        fill="#2A337E"
      />
      <Defs>
        <LinearGradient
          id="paint0_linear_2616_8734"
          x1="123.62"
          y1="100.871"
          x2="123.62"
          y2="307.002"
          gradientUnits="userSpaceOnUse"
        >
          <Stop stopColor="#F1F4FD" />
          <Stop offset="1" stopColor="#DFE7FA" />
        </LinearGradient>
        <LinearGradient
          id="paint1_linear_2616_8734"
          x1="198.06"
          y1="0"
          x2="198.06"
          y2="132.215"
          gradientUnits="userSpaceOnUse"
        >
          <Stop stopColor="#F1F4FD" />
          <Stop offset="1" stopColor="#DFE7FA" />
        </LinearGradient>
        <LinearGradient
          id="paint2_linear_2616_8734"
          x1="163.883"
          y1="189.95"
          x2="162.334"
          y2="213.037"
          gradientUnits="userSpaceOnUse"
        >
          <Stop stopColor="#486BE2" />
          <Stop offset="1" stopColor="#2445CD" />
        </LinearGradient>
      </Defs>
    </Svg>
  )
}
